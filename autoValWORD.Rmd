---
output:
  word_document: default
  html_document: default
---
![](logo_pos.png){width="150" height="32"}

---
output:
  word_document: default
  pdf_document: default
  html_document: default
  '': default
  allways_allow_html: true
---

---
output:
  html_document:
    css: "style.css"
    fig_width: 7
    fig_height: 6
    fig_caption: true
    df_print: paged
  pdf_document: default
  '': default
date: "`r format(Sys.time(), '%A %d. %B %Y')`"
---

```{r setup, include=FALSE}
library(knitr)
library(shiny)
library(parallel)
library(robslopes)
library(readxl)
library(mcr)
opts_chunk$set(echo = TRUE)
```

## Validations-Auswertung

<!-- Prepare libraries and import data from Excel -->

<!-- create vectors method.x and method.y, run Passing Bablok regression -->

<!-- change column names in PB.reg@mnames to prepare for dynamic title-, axis- & legend labels-->

```{r prepareData, echo=FALSE}

## Import Data from a xlsx file, create the vectors for reference x and test y
validation.data <- read_xlsx("C:/R_local/Validation_Data.xlsx")
method.x <- validation.data[[1]]
method.y <- validation.data[[2]]
## PaBa (formal class names: PB.reg) regression, rename column titles in PB.reg@mnames
PB.reg <- mcreg(method.x,method.y, method.reg = "PaBa")
PB.reg@mnames[1] <- colnames(validation.data)[1]
PB.reg@mnames[2] <- colnames(validation.data)[2]

```

---
title: "`r paste("Validation: ", colnames(validation.data)[2],"vs", colnames(validation.data)[1])`"
---

## Messdaten

```{r datatable, echo=FALSE}
kable(MCResult.getData(PB.reg), caption = paste("x", colnames(validation.data)[1], "---y", colnames(validation.data)[2]))
```

### Korrelation

<!-- Pearsson correlation and plot, sample number n from PB.reg@data -->

```{r, echo=FALSE}

## Correlation plot with Pearsson correlation
## Creating the plot
plot(method.x, method.y, pch = 19, col = "#68228B", 
     xlab=colnames(validation.data)[1], ylab=colnames(validation.data)[2])

## Regression line
abline(lm(method.y ~ method.x), col = "red", lwd = 3)

## Pearson correlation
text(paste("Pearson's r:", round(cor(method.x, method.y), 2)), x=40, y=10)
text(paste("n=", nrow(PB.reg@data)), x=40, y=5)

```

### Regression nach Passing Bablok

<!-- Passing Bablok Plot mit Steigung, Achsenabschnitt, Spearman's correlation  -->

```{r PB, echo=FALSE}

MCResult.plot(PB.reg, equal.axis = TRUE, x.lab = colnames(validation.data)[1], y.lab = colnames(validation.data)[2], points.col = "#68228B", points.pch = 19, ci.area = TRUE, ci.area.col = "#0000FF50", main = paste("Validation", colnames(validation.data)[2], "vs", colnames(validation.data)[1]), sub = "", add.cor = TRUE, cor.method = "spearman", add.grid = FALSE, points.cex = 1)
##Angabe Steigung und Achsenabschnitt und CI
intercept_est <- PB.reg@para[1]
intercept_lci <- PB.reg@para[5]
intercept_uci <- PB.reg@para[7]
gradient_est <- PB.reg@para[2]
gradient_lci <- PB.reg@para[6]
gradient_uci <- PB.reg@para[8]
alpha_ci <- PB.reg@alpha[1]
text(40,20,sprintf("Gradient : %4.2f (%4.2f - %4.2f)", gradient_est, gradient_lci, gradient_uci))
text(40,15,sprintf("Intercept : %4.2f (%4.2f - %4.2f)", intercept_est, intercept_lci, intercept_uci))
text(40,10, sprintf("Alpha : %4.2f", alpha_ci))

```

### Bland-Altman

> Hier k√∂nnte der Bland-Altman-Plot erscheinen:

```{r BA, echo=FALSE}
MCResult.plotDifference(PB.reg)
```

```{r BArel, echo=FALSE}
MCResult.plotDifference(PB.reg, plot.type = 8)
```

<!-- ## Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the ## R code that generated the plot. -->

***Dieser muss noch verbessert werden!***

### Schlussfolgerung und Freigabe

<!-- User Input zur Beurteilung und Freigabe -->

Bitte gib hier Deine Beurteilung der vorliegenden Verifikation/Validation ein:
